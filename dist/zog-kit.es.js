var t=Object.defineProperty,e=Object.defineProperties,s=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,i=(e,s,o)=>s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[s]=o,a=(t,e)=>{for(var s in e||(e={}))r.call(e,s)&&i(t,s,e[s]);if(o)for(var s of o(e))n.call(e,s)&&i(t,s,e[s]);return t},c=(t,o)=>e(t,s(o));const u={name:"ZogKit",version:"0.3.0",install(t,e={}){const{reactive:s,ref:o,computed:r,watchEffect:n,addHook:i,utils:u}=t,{compile:l,Scope:d,evalExp:h}=u,f={http:{baseURL:e.baseURL||"",timeout:e.timeout||3e4,headers:e.headers||{}},storage:{prefix:e.storagePrefix||"zog_",ttl:e.storageTTL||null}};if(i("beforeCompile",t=>{if(1===t.nodeType&&t.hasAttribute("z-pre"))return t.removeAttribute("z-pre"),!1}),i("beforeCompile",(t,e,s)=>{if(1!==t.nodeType||!t.hasAttribute("z-once"))return;t.removeAttribute("z-once");const o=t=>{if(!t)return;if(3===t.nodeType){const s=t.textContent;return void(s.includes("{{")&&(t.textContent=s.replace(/{{\s*(.*?)\s*}}/g,(t,s)=>{var o;try{return null!=(o=h(s,e))?o:""}catch(r){return""}})))}if(1!==t.nodeType)return;const s=[];for(const o of[...t.attributes]){const{name:n,value:i}=o;if(n.startsWith("@")||n.startsWith("z-on:"))s.push(n);else if(n.startsWith(":")||n.startsWith("z-")){s.push(n);try{const s=":"===n[0]?n.slice(1):n,o=h(i,e);if("z-text"===s)t.textContent=null!=o?o:"";else if("z-html"===s)t.innerHTML=null!=o?o:"";else if("z-show"===s)t.style.display=o?"":"none";else if("class"===s)if("object"==typeof o&&null!==o){const e=Object.keys(o).filter(t=>o[t]).join(" ");t.className=(t.className+" "+e).trim()}else"string"==typeof o&&(t.className=(t.className+" "+o).trim());else s.startsWith("z-")||("boolean"==typeof o?o?t.setAttribute(s,""):t.removeAttribute(s):null!=o&&t.setAttribute(s,String(o)))}catch(r){}}}s.forEach(e=>t.removeAttribute(e)),[...t.childNodes].forEach(o)};return o(t),!1}),!document.getElementById("zog-kit-styles")){const t=document.createElement("style");t.id="zog-kit-styles",t.textContent="[z-cloak] { display: none !important; }",document.head.appendChild(t)}i("afterCompile",t=>{1===t.nodeType&&t.hasAttribute("z-cloak")&&t.removeAttribute("z-cloak")}),i("beforeCompile",(t,e,s)=>{if(1!==t.nodeType||!t.hasAttribute("z-autofocus"))return;t.removeAttribute("z-autofocus");const o="af-"+Math.random().toString(36).substr(2,6);t.setAttribute("data-autofocus",o);const r=()=>{const t=document.querySelector(`[data-autofocus="${o}"]`);return!(!t||!document.body.contains(t))&&(t.focus(),!0)};requestAnimationFrame(()=>{if(r())return;const t=new MutationObserver(()=>{r()&&t.disconnect()});t.observe(document.body,{childList:!0,subtree:!0}),s.addEffect(()=>t.disconnect())})}),i("beforeCompile",(t,e,s)=>{if(1!==t.nodeType||!t.hasAttribute("z-click-outside"))return;const o=t.getAttribute("z-click-outside");t.removeAttribute("z-click-outside");const r="zog-outside-"+Math.random().toString(36).substr(2,9);t.setAttribute("data-click-outside-id",r);let i=null;s.addEffect(n(()=>{const s=document.body.contains(t);if(i&&(document.removeEventListener("click",i,!0),i=null),s){const t=t=>{const s=document.querySelector(`[data-click-outside-id="${r}"]`);if(!s||s.contains(t.target))return;const n=e[o];if("function"==typeof n)n(t);else try{Function(...Object.keys(e),"e","$event",`"use strict";${o}`)(...Object.values(e),t,t)}catch(i){}};setTimeout(()=>{document.addEventListener("click",t,!0),i=t},0)}})),s.addEffect(()=>{i&&document.removeEventListener("click",i,!0),t.removeAttribute("data-click-outside-id")})});const p=new class{constructor(t={}){this.config=a(a({},f.http),t),this.pendingRequests=/* @__PURE__ */new Map}async request(t,e={}){const s=t.startsWith("http")?t:this.config.baseURL+t,o=new AbortController,r=a({method:e.method||"GET",headers:a(a({"Content-Type":"application/json"},this.config.headers),e.headers),signal:o.signal},e),n=setTimeout(()=>o.abort(),e.timeout||this.config.timeout);!e.body||e.body instanceof FormData||(r.body=JSON.stringify(e.body));try{const t=await fetch(s,r);if(clearTimeout(n),!t.ok)throw new Error(`HTTP Error: ${t.status}`);const e=t.headers.get("content-type");return{data:(null==e?void 0:e.includes("application/json"))?await t.json():await t.text(),response:t,status:t.status}}catch(i){throw clearTimeout(n),i}}get(t,e={}){return this.request(t,c(a({},e),{method:"GET"}))}post(t,e,s={}){return this.request(t,c(a({},s),{method:"POST",body:e}))}put(t,e,s={}){return this.request(t,c(a({},s),{method:"PUT",body:e}))}delete(t,e={}){return this.request(t,c(a({},e),{method:"DELETE"}))}};class m{constructor(t,e="zog_"){this.storage=t,this.prefix=e}_getKey(t){return this.prefix+t}set(t,e,s=null){try{return this.storage.setItem(this._getKey(t),JSON.stringify({value:e,timestamp:Date.now(),ttl:s})),!0}catch(o){return!1}}get(t,e=null){try{const s=this.storage.getItem(this._getKey(t));if(!s)return e;const o=JSON.parse(s);return o.ttl&&Date.now()-o.timestamp>o.ttl?(this.remove(t),e):o.value}catch(s){return e}}remove(t){this.storage.removeItem(this._getKey(t))}clear(){Object.keys(this.storage).forEach(t=>{t.startsWith(this.prefix)&&this.storage.removeItem(t)})}has(t){return null!==this.storage.getItem(this._getKey(t))}reactive(t,e=null,s=null){const r=this.get(t,e),i=o(r);return n(()=>{this.set(t,i.value,s)}),i}}const b=new m(localStorage,f.storage.prefix),y=new m(sessionStorage,f.storage.prefix);function v(t,e=300){let s;return function(...o){clearTimeout(s),s=setTimeout(()=>t.apply(this,o),e)}}function g(t,e=300){let s;return function(...o){s||(t.apply(this,o),s=!0,setTimeout(()=>s=!1,e))}}i("beforeCompile",(t,e,s)=>{if(1!==t.nodeType)return;const o=[],r=[];[...t.attributes].forEach(t=>{if(t.name.startsWith("@")||t.name.startsWith("z-on:")){const e=t.name.split(".");if(e.length>1){const s=e.slice(1),n=s.includes("debounce"),i=s.includes("throttle");if(n||i){const i=parseInt(s.find(t=>!isNaN(t)))||300,a="@"===t.name[0]?e[0].slice(1):e[0].slice(5),c=t.value;o.push(t.name),r.push({eventName:a,expression:c,wrapper:n?v:g,delay:i})}}}}),o.forEach(e=>t.removeAttribute(e)),r.forEach(({eventName:o,expression:r,wrapper:n,delay:i})=>{const a=n(t=>{const s=e[r];if("function"==typeof s)s(t);else try{Function(...Object.keys(e),"e",`"use strict";${r}`)(...Object.values(e),t)}catch(o){}},i);t.addEventListener(o,a),s.addListener(t,o,a)})});const z=new IntersectionObserver(t=>{t.forEach(t=>{if(t.isIntersecting){const e=t.target,s=e.getAttribute("data-lazy-src");s&&(e.src=s,e.removeAttribute("data-lazy-src"),z.unobserve(e))}})},{rootMargin:"50px"});i("afterCompile",t=>{if(1===t.nodeType&&t.hasAttribute("z-lazy")){const e=t.getAttribute("z-lazy");t.removeAttribute("z-lazy"),t.setAttribute("data-lazy-src",e),z.observe(t)}});const E={async copy(t){try{return await navigator.clipboard.writeText(t),!0}catch(e){const s=document.createElement("textarea");s.value=t,s.style.cssText="position:fixed;opacity:0",document.body.appendChild(s),s.select();const o=document.execCommand("copy");return document.body.removeChild(s),o}}};i("beforeCompile",(t,e,s)=>{if(1!==t.nodeType||!t.hasAttribute("z-copy"))return;const o=t.getAttribute("z-copy");t.removeAttribute("z-copy");const r=async()=>{try{const s=h(o,e);await E.copy(String(s))&&t.dispatchEvent(new CustomEvent("copied",{detail:s,bubbles:!0}))}catch(s){}};t.addEventListener("click",r),s.addListener(t,"click",r)});const w=new class{constructor(){this.events=/* @__PURE__ */new Map}on(t,e){return this.events.has(t)||this.events.set(t,/* @__PURE__ */new Set),this.events.get(t).add(e),()=>this.off(t,e)}off(t,e){var s;null==(s=this.events.get(t))||s.delete(e)}emit(t,e){var s;null==(s=this.events.get(t))||s.forEach(t=>t(e))}once(t,e){const s=o=>{e(o),this.off(t,s)};this.on(t,s)}clear(t){t?this.events.delete(t):this.events.clear()}};return{$http:p,$storage:b,$session:y,$clipboard:E,$bus:w,utils:{debounce:v,throttle:g},version:this.version}}};export{u as ZogKit,u as default};
//# sourceMappingURL=zog-kit.es.js.map
