<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ZogHttp Test</title>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: 2rem auto; padding: 0 1rem; }
    button { margin: 0.5rem 0.25rem; padding: 0.5rem 1rem; cursor: pointer; }
    .loading { color: orange; }
    .error { color: red; }
    .user { padding: 0.5rem; margin: 0.25rem 0; background: #f5f5f5; border-radius: 4px; }
    .progress { width: 100%; height: 8px; background: #eee; border-radius: 4px; }
    .progress-bar { height: 100%; background: #4caf50; border-radius: 4px; transition: width 0.2s; }
  </style>
</head>
<body>
  <div id="app">
    <h1>ZogHttp Test</h1>
    
    <!-- Loading State -->
    <p z-show="$http.state.loading" class="loading">⏳ Loading...</p>
    
    <!-- Fetch Users -->
    <section>
      <h3>Users</h3>
      <button @click="fetchUsers">Fetch Users</button>
      <div z-for="user in users" :key="user.id" class="user">
        {{ user.name }} - {{ user.email }}
      </div>
    </section>
    
    <!-- Create Post -->
    <section>
      <h3>Create Post</h3>
      <input z-model="postTitle" placeholder="Post title" />
      <button @click="createPost">Create</button>
      <p z-if="postResult">✅ Created: {{ postResult }}</p>
    </section>
    
    <!-- File Upload -->
    <section>
      <h3>Upload File</h3>
      <input type="file" @change="uploadFile" />
      <div z-if="upload.status === 'uploading'">
        <div class="progress">
          <div class="progress-bar" :style="{ width: upload.progress + '%' }"></div>
        </div>
        <small>{{ upload.progress }}%</small>
      </div>
      <p z-if="upload.status === 'completed'">✅ Upload complete!</p>
      <p z-if="upload.status === 'error'" class="error">❌ {{ upload.error }}</p>
    </section>
    
    <!-- Error -->
    <p z-if="error" class="error">❌ {{ error }}</p>
  </div>

  <script type="module">
    import { createApp, ref, reactive } from '../node_modules/zogjs/dist/0.4.8/zog.js';
    import { ZogHttpPlugin, $http } from './../src/zog-http.js';
    
    createApp(() => {
      const users = reactive([]);
      const postTitle = ref('');
      const postResult = ref('');
      const error = ref('');
      const upload = reactive({ status: 'idle', progress: 0, error: null });
      
      async function fetchUsers() {
        try {
          error.value = '';
          const res = await $http.get('/users', { params: { _limit: 5 } });
          users.splice(0, users.length, ...res.data);
        } catch (e) { error.value = e.message; }
      }
      
      async function createPost() {
        if (!postTitle.value) return;
        try {
          error.value = '';
          const res = await this.$http.post('/posts', { title: postTitle.value, body: 'Test' });
          postResult.value = res.data.title + ' (ID: ' + res.data.id + ')';
          postTitle.value = '';
        } catch (e) { error.value = e.message; }
      }
      
      function uploadFile(e) {
        const file = e.target.files[0];
        if (!file) return;
        
        // Simulated upload (JSONPlaceholder doesn't support real uploads)
        upload.status = 'uploading';
        upload.progress = 0;
        
        const interval = setInterval(() => {
          upload.progress += 20;
          if (upload.progress >= 100) {
            clearInterval(interval);
            upload.status = 'completed';
          }
        }, 300);
      }
      
      return { users, postTitle, postResult, error, upload, fetchUsers, createPost, uploadFile };
    })
    .use(ZogHttpPlugin, {
      baseURL: 'https://jsonplaceholder.typicode.com',
      timeout: 10000
    })
    .mount('#app');
  </script>
</body>
</html>